syntax = "proto2";

message HdpMessage {
  /* optional int64 timestamp = 1; */
  oneof msg {
    ReadDirRequest readDirRequest = 1;
    ReadDirResponse readDirResponse = 2;
    StatRequest statRequest = 3;
    StatResponse statResponse = 4;
    OpenRequest openRequest = 5;
    OpenResponse openResponse = 6;
    ReadRequest readRequest = 7;
    ReadResponse readResponse = 8;
    CloseRequest closeRequest = 9;
    CloseResponse closeResponse = 10;
  }
}

message StatRequest {
  required string path = 1;
}

message StatResponse {
  required string path = 1;
  oneof response {
    uint32 err = 2;
    Stat stat = 3;
  }
}

message Stat {
  optional uint32 size = 1;
  optional uint64 atime = 2;
  optional uint64 mtime = 3;
  optional uint64 ctime = 4;
  optional uint32 mode = 5;
  optional uint32 dev = 6;
  optional uint64 ino = 7;
}

message ReadDirRequest {
  required string path = 1;
}

message OpenRequest {
  required string path = 1;
}

message OpenResponse {
  required string path = 1;
  oneof response {
    uint32 err = 2;
    uint32 fd = 3;
  }
}

message ReadRequest {
  required uint32 fd = 1;
  required uint32 len = 2;
  required uint32 pos = 3;
}

message ReadResponse {
  required uint32 fd = 1;
  required uint32 len = 2;
  required uint32 pos = 3;
  oneof response {
    uint32 err = 4;
    bytes data = 5;
  }
}

message ReadDirResponse {
  optional string path = 1;
  oneof response {
    uint32 err = 2;
    Dir dir = 3;
  }
}

message Dir {
  repeated string file = 1;
}

message CloseRequest {
  required uint32 fd = 1;
}

message CloseResponse {
  required uint32 fd = 1;
  optional uint32 err = 2;
}
